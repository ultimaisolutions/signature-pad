<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Sign Here</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }
    canvas {
      border: 2px solid #000;
      background-color: #fff;
      touch-action: none;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
  <!-- Include the Signature Pad library -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
</head>
<body>

  <h2>אנא חתום למטה</h2>
  <canvas id="signaturePad" width="400" height="200"></canvas><br>
  <button id="clear">נקה</button>
  <button id="submit">שלח חתימה</button>

  <script>
    const canvas = document.getElementById('signaturePad');
    const signaturePad = new SignaturePad(canvas, {
      backgroundColor: 'rgb(255,255,255)', // white background
      penColor: 'black'
    });

    // Clear the pad
    document.getElementById('clear').addEventListener('click', () => {
      signaturePad.clear();
    });

    // Helper to read “uuid” from URL
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // On Submit: export blob and POST as form-data
    document.getElementById('submit').addEventListener('click', () => {
      if (signaturePad.isEmpty()) {
        alert('אנא צייר חתימה לפני השליחה');
        return;
      }
      const uuid = getQueryParam('uuid') || Date.now().toString();

      // Convert canvas to JPEG blob
      canvas.toBlob(blob => {
        const form = new FormData();
        form.append('uuid', uuid);
        form.append('signature', blob, 'signature.jpg');

        fetch('https://hook.eu2.make.com/7b7m3jq4864m4hmon7bir8lrq3dqsynh', {
          method: 'POST',
          body: form
        })
        .then(res => {
          if (!res.ok) throw new Error(res.statusText);
          alert('החתימה נשמרה בהצלחה');
        })
        .catch(err => {
          console.error(err);
          alert('שליחת החתימה נכשלה');
        });
      }, 'image/jpeg');
    });
  </script>

</body>
</html>
